.auth-wrapper {
  background: 
      linear-gradient(to right, rgba(30,30,30,0.9), rgba(45,45,45,0.9)), 
      url('../images/jewelry-bg.jpg') no-repeat center center/cover;
}

.auth-container {
  background-color: #fff;
  padding: 2.5rem 2rem;
  border-radius: 15px;
  max-width: 450px;
  width: 100%;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
}

.auth-container h2 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: #C1272D;
  font-family: 'Playfair Display', serif;
}

.auth-container label {
  color: #e0e0e0;
  display: block;
  margin-top: 15px;
  margin-bottom: 5px;
  font-size: 14px;
}

.form-input {
  width: 100%;
  padding: 0.75rem;
  margin-bottom: 1rem;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 1rem;
}

.form-input:focus {
  border-color: #C1272D;
  outline: none;
}

label {
  font-weight: 600;
  margin-bottom: 0.3rem;
  display: block;
  color: #333;
}

.form-label {
  color: #ffffff;
}

/* Submit button */
.btn-submit {
  width: 100%;
  padding: 0.75rem;
  background-color: #C1272D;
  border: none;
  color: #fff;
  font-size: 1rem;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.btn-submit:hover {
  background-color: #a51d23;
}
form {
  animation: fadeIn 1s ease;
}

/* ========== AUTH FORMS ========== */
.auth-wrapper {
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(to right, #1e1e1e, #2d2d2d);
    padding: 2rem;
}

/* ========== AUTH FORMS ========== */

.auth-wrapper {
    background-color: #1a1a1a;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
}

.auth-container {
    background-color: #2a2a2a;
    padding: 2rem 3rem;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
    color: #d4d4d4; /* Slightly darker than default #e0e0e0 */
    max-width: 400px;
    width: 100%;
}

.auth-container h2 {
    text-align: center;
    margin-bottom: 1.5rem;
    color: #f0f0f0; /* Brighter for headers */
}

.auth-container label {
    display: block;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #cccccc; /* Medium-light gray for readability */
}

.form-input {
    width: 100%;
    padding: 0.75rem 1rem;
    background-color: #1e1e1e;
    border: 1px solid #444;
    border-radius: 8px;
    color: #f0f0f0;
    font-size: 1rem;
}

.form-input::placeholder {
    color: #999;
}

.btn-submit {
    margin-top: 1.5rem;
    width: 100%;
    padding: 0.75rem;
    background-color: #c1272d;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.btn-submit:hover {
    background-color: #a81f25;
}

.form-switch {
    margin-top: 1rem;
    text-align: center;
    font-size: 0.95rem;
    color: #bbbbbb;
}

.form-switch a {
    color: #e34a6f;
    text-decoration: none;
}
.form-switch a:hover {
    text-decoration: underline;
}

class OrderItem(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    order_id = db.Column(db.Integer, db.ForeignKey('order.id', name='fk_orderitem_order_id'), nullable=False)
    product_id = db.Column(db.Integer, db.ForeignKey('product.id'), nullable=False)
    quantity = db.Column(db.Integer, nullable=False)
    price_each = db.Column(db.Float, nullable=False)

    def __str__(self):
        return f'<OrderItem Order#{self.order_id} - Product#{self.product_id}>'


          # Relationships
    items = db.relationship('OrderItem', backref='order', lazy=True)





    .auth-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background-color: #1a1a1a; /* keep your dark background */
      padding: 2rem;
  }
  
  .auth-container {
      background-color: #2a2a2a; /* dark silver backdrop */
      padding: 2rem 3rem;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
      color: #dedede; /* silver text */
      max-width: 400px;
      width: 100%;
      border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .auth-container h2 {
      text-align: center;
      margin-bottom: 1.5rem;
      color: #f2f2f2; /* bright silver/white */
      letter-spacing: 1px;
      font-weight: 600;
  }
  
  .auth-container label {
      display: block;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #cfcfcf; /* a touch more contrast */
  }
  
  .form-input {
      width: 100%;
      padding: 0.75rem 1rem;
      background-color: #1e1e1e;
      border: 1px solid #444;
      border-radius: 8px;
      color: #f0f0f0;
      font-size: 1rem;
      transition: border 0.3s ease;
  }
  
  .form-input:focus {
      border-color: #d60036; /* Hayat red */
      outline: none;
  }
  
  .btn-submit {
      margin-top: 1.5rem;
      width: 100%;
      padding: 0.75rem;
      background-color: #c1272d; /* deep red */
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
  }
  
  .btn-submit:hover {
      background-color: #a81f25;
      transform: translateY(-1px);
  }
  
  .form-switch {
      margin-top: 1rem;
      text-align: center;
      font-size: 0.95rem;
      color: #bbbbbb;
  }
  
  .form-switch a {
      color: #e34a6f;
      text-decoration: none;
      font-weight: 500;
  }
  
  .form-switch a:hover {
      text-decoration: underline;
  }
  










  /* ========== GLOBAL IMPORTS ========== */
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;700&display=swap');

/* ========== GLOBAL STYLES ========== */
body {
    background-color: #1a1a1a; /* Deep black */
    font-family: 'Roboto', sans-serif;
    color: #e0e0e0;
    margin: 0;
    padding: 0;
}

/* ========== HERO SECTION ========== */

.hero-section {
    width: 100%;
    height: 60vh;
    background: linear-gradient(to bottom, rgba(0,0,0,0.4), rgba(0,0,0,0.6)), 
                url('../images/snipped_back.jpg') no-repeat center center/cover;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    text-align: center;
    padding: 2rem;
}

.hero-section h1 {
    font-size: 3.5rem;
    font-weight: 600;
    font-family: 'Inter', sans-serif;
    color: #fff;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
}

.hero-section p.lead {
    font-size: 1.25rem;
    color: #f0f0f0;
    margin-top: 1rem;
}

.hero-section .btn-primary {
    background-color: #C1272D;
    border: none;
    color: #fff;
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    border-radius: 8px;
    margin-top: 1rem;
}

.hero-section .btn-primary:hover {
    background-color: #a81f25;
    transform: translateY(-2px);
}




/* ========== CATEGORY SECTION ========== */

.category-link {
    text-decoration: none;
    color: inherit;
}

.category-card {
    position: relative;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    background-color: #eee;
    border: 1px solid white;
}

.category-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
    z-index: 1;
}

.category-card:hover img {
    transform: scale(1.05);
}



.category-overlay {
    position: absolute;
    bottom: 0;
    width: 100%;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(4px);
    text-align: center;
    color: #1a1a1a; /* Dark text */
    z-index: 2;
}

.category-name {
    font-weight: bold;
    margin: 0;
    font-size: 1.2rem;
}

.shop-now {
    font-size: 0.9rem;
    color: #d60036;
    font-weight: 500;
}





.category-card::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid white; /* Slim line between cards */
    box-sizing: border-box;
    pointer-events: none;
}









.card-cover h2 {
    font-family: 'poppins', sans-serif; /* or 'Lora', serif if you prefer */
    font-size: 1.3rem; /* base size for large screens */
    font-weight: 600;
    text-decoration: none;
    line-height: 1.2;
    word-break: keep-all;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }
  
  /* Medium screens */
  @media (max-width: 992px) {
    .card-cover h2 {
      font-size: 1.1rem;
      white-space: normal;
    }
  }
  
  /* Small screens */
  @media (max-width: 576px) {
    .card-cover h2 {
      font-size: 1.0rem;
      text-align: center;
    }
  }



/* ========== PRODUCT SECTION ========== */
#shop {
    background-color: #f5f5f5;
    padding: 40px 0;
}

.card.product-card {
    background-color: #ffffff;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    overflow: hidden;
    border: none;
}

.card.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
}

.product-img {
    height: 200px;
    object-fit: cover;
    border-radius: 10px 10px 0 0;
}

.card-body {
    padding: 15px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.card-title {
    font-size: 1.2rem;
    font-weight: bold;
    color: #333;
    font-family: 'Playfair Display', serif;
}

.product-price {
    font-size: 1.1rem;
    font-weight: bold;
    color: #C1272D;
}

.product-link {
    text-decoration: none;
    color: inherit;
}



/* ========== BUTTONS ========== */
.btn-primary {
    background-color: #C1272D;
    color: #FFFFFF;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    transition: background-color 0.3s ease;
    font-weight: bold;
}

.btn-primary:hover {
    background-color: #A02024;
}

.btn-secondary {
    background-color: #C0C0C0;
    color: #333333;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    transition: background-color 0.3s ease;
}

.btn-secondary:hover {
    background-color: #A9A9A9;
}

.btn-outline-secondary {
    background-color: transparent;
    color: #333;
    border: 1px solid #333;
    border-radius: 5px;
}





/* ========== AUTH FORMS ========== */


.auth-wrapper {
    padding: 2rem;
  }
  
  .auth-container {
    background: #1c1c1c;
    border-radius: 10px;
    padding: 2rem;
    max-width: 700px;
    margin: auto;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.05);
  }
  
  .form-group {
    margin-bottom: 1rem;
  }
  
  .form-row {
    display: flex;
    gap: 1rem;
  }
  
  .form-input {
    width: 100%;
    padding: 0.75rem;
    border: none;
    border-radius: 5px;
    background: #2a2a2a;
    color: white;
  }
  
  .btn-submit {
    background: #e63946;
    color: white;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    margin-top: 1rem;
    transition: background 0.3s ease;
  }
  
  .btn-submit:hover {
    background: #d62839;
  }



  .order-summary, .ordered-items {
    margin-top: 1.5rem;
    padding: 1rem;
    background: #2a2a2a;
    border-radius: 8px;
  }
  
  .ordered-items ul {
    list-style: none;
    padding: 0;
  }
  
  .ordered-items li {
    margin-bottom: 0.5rem;
    border-bottom: 1px solid #444;
    padding-bottom: 0.5rem;
  }



/* Container box */


@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ========== RESPONSIVE PRODUCT GRID ========== */
@media (max-width: 768px) {
    .row-cols-md-4 > .col,
    .col-md-4 {
        flex: 0 0 50%;
        max-width: 50%;
    }
}

@media (max-width: 576px) {
    .row-cols-md-4 > .col,
    .col-md-4 {
        flex: 0 0 100%;
        max-width: 100%;
    }
}


/* ========== NAVBAR ========== */

/* Navbar base styling */
.navbar {
    font-family: 'Poppins', sans-serif;
    font-weight: 500;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
}

/* Navbar brand */
.navbar-brand {
    font-size: 1.5rem;
    font-weight: 600;
    color: #c4002f; /* Match your red theme */
}

/* Nav links */
.navbar-nav .nav-link {
    margin-right: 1rem;
    color: #333;
    transition: color 0.3s ease;
}

.navbar-nav .nav-link:hover {
    color: #c4002f;
}

/* Cart styling */
.navbar-nav .nav-item:last-child {
    margin-left: auto;
}

.navbar-nav .nav-link.text-bg-dark {
    background-color: #222;
    border-radius: 0.5rem;
    padding: 0.4rem 0.8rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #fff;
    transition: background-color 0.3s ease;
}

.navbar-nav .nav-link.text-bg-dark:hover {
    background-color: #c4002f;
}

/* Badge styling inside cart */
.navbar-nav .badge.bg-success {
    font-size: 0.75rem;
    margin-right: 0.25rem;
}

/* Dropdown hover effect */
.dropdown-menu {
    border-radius: 0.5rem;
    border: none;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.dropdown-item:hover {
    background-color: #f8f9fa;
    color: #c4002f;
}

/* Search bar */
form .form-control {
    width: 200px;
    border-radius: 0.5rem;
    transition: border 0.3s ease;
}

form .form-control:focus {
    border-color: #c4002f;
    box-shadow: none;
}


/* ========== Cart ========== */

.cart-btn {
    background-color: transparent;
    color: #dc3545;
    border: 2px solid #dc3545;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 18px;
    cursor: pointer;
    transition: 0.2s;
    margin: 0 4px;
}

.cart-btn:hover {
    background-color: #dc3545;
    color: white;
}

.cart-btn:focus {
    outline: none;
    box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.4);
}

.cart-icon {
    font-weight: bold;
    font-size: 18px;
    display: inline-block;
    width: 28px;
    text-align: center;
}

.remove-cart {
    background-color: #6c757d; /* dark gray */
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.remove-cart:hover {
    background-color: #5a6268;
}





/* ========== Form switch css ========== */
.form-switch {
    text-align: center;
    margin-top: 1rem;
    color: #555;
    font-size: 0.95rem;
}

.form-switch a {
    color: #C1272D;
    text-decoration: none;
    font-weight: 600;
}

.form-switch a:hover {
    text-decoration: underline;
}

.text-warning {
    color: #ffc107; /* gold stars */
}





{% extends 'base.html' %}

{% block title %}
View Orders
{% endblock %}

{% block body %}
<div class="container mt-5" style="background-color: #f8f9fa; border-radius: 10px; padding: 30px;">
    <h2 class="mb-4 text-dark">Customer Orders</h2>

    {% for order in orders %}
    <div class="card mb-4 shadow-sm border-start border-4 {% if order.status == 'shipped' %}border-success{% elif order.status == 'pending' %}border-warning{% else %}border-secondary{% endif %}">
        <div class="card-body d-flex justify-content-between align-items-center">
            <div>
                <h5 class="card-title mb-2 text-dark">Order #{{ order.id }}</h5>
                <p class="card-text text-secondary mb-1">
                    <strong class="text-dark">Customer:</strong> {{ order.customer_name }}<br>
                    <strong class="text-dark">Status:</strong> 
                    <span class="badge 
                        {% if order.status == 'shipped' %}bg-success
                        {% elif order.status == 'pending' %}bg-warning text-dark
                        {% else %}bg-secondary{% endif %}">
                        {{ order.status.title() }}
                    </span><br>
                    <strong class="text-dark">Created:</strong> {{ order.created_at.strftime('%Y-%m-%d %H:%M') }}
                </p>
            </div>
            <button class="btn btn-outline-dark" data-bs-toggle="modal" data-bs-target="#orderModal{{ order.id }}">
                View Details
            </button>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="orderModal{{ order.id }}" tabindex="-1" aria-labelledby="orderModalLabel{{ order.id }}" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content bg-white text-dark border">
                <div class="modal-header">
                    <h5 class="modal-title" id="orderModalLabel{{ order.id }}">Order #{{ order.id }} Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">
                        <strong>Customer Name:</strong> {{ order.customer_name }}<br>
                        <strong>Email:</strong> {{ order.customer_email }}<br>
                        <strong>Phone:</strong> {{ order.customer_phone }}<br>
                        <strong>Shipping Address:</strong> {{ order.shipping_address }}<br>
                        <strong>Status:</strong> 
                        <span class="badge 
                            {% if order.status == 'shipped' %}bg-success
                            {% elif order.status == 'pending' %}bg-warning text-dark
                            {% else %}bg-secondary{% endif %}">
                            {{ order.status.title() }}
                        </span><br>
                        <strong>Total:</strong> ${{ '%.2f' % order.total }}
                    </p>
                    <hr>
                    <h6 class="text-dark">Items:</h6>
                    <ul class="list-group list-group-flush">
                        {% for item in order.items %}
                        <li class="list-group-item bg-light text-dark">
                            {{ item.product.name }} (x{{ item.quantity }}) - ${{ '%.2f' % item.product.price }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="modal-footer">
                    <form method="POST" action="{{ url_for('admin.update_order_status', order_id=order.id) }}" class="d-flex align-items-center">
                        {{ forms[order.id].csrf_token }}
                        {{ forms[order.id].status(class="form-select form-select-sm bg-white text-dark border me-2") }}
                        <button type="submit" class="btn btn-sm btn-outline-dark">Update</button>
                    </form>
                    <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}














{% extends "base.html" %}

{% block title %}{{ product.product_name }}{% endblock %}

{% block body %}
<div class="container my-5">
  <div class="row g-5">
    <!-- Product Image -->
    <div class="col-md-6">
      <img src="{{ product.product_picture }}"
           alt="{{ product.product_name }}"
           class="img-fluid rounded shadow-sm">
    </div>

    <!-- Product Info -->
    <div class="col-md-6">
      <h2 class="fw-bold mb-3">{{ product.product_name }}</h2>
      <h4 class="text-danger mb-4">${{ '%.2f'|format(product.price) }}</h4>
      <p class="text-muted">{{ product.description }}</p>

      <!-- Action Buttons -->
      <div class="d-flex gap-3 mt-4 mb-5">
        <form action="{{ url_for('cart_routes.add_to_cart', item_id=product.id) }}" method="POST">
            {{ csrf_token() }}
            {% if product.category.lower() == 'ring' %}
              <label for="size">Ring Size</label>
              <select name="size" id="size" class="form-select w-auto mb-3">
                {% for s in range(5,10) %}
                  <option value="{{ s }}">{{ s }}</option>
                {% endfor %}
              </select>
            {% endif %}
            <button type="submit" class="btn btn-dark btn-lg">Add to Cart</button>
        </form>

        <form action="{{ url_for('cart_routes.add_to_wishlist', item_id=product.id) }}"
              method="POST">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button type="submit" class="btn btn-outline-secondary btn-lg shadow-sm px-4">
            ❤️ Wishlist
          </button>
        </form>
      </div>

      <!-- Reviews Section (moved up) -->
      <div class="mb-5">
        <h3 class="fw-bold mb-4 text-danger">Customer Reviews</h3>

        {% if reviews %}
          {% for review in reviews %}
            <div class="mb-4 p-3 border rounded" style="background-color: #f8f9fa; color: #333;">
              <div class="d-flex justify-content-between">
                <strong class="text-capitalize">{{ review.customer.username }}</strong>
                <span class="text-warning">
                  {% for i in range(review.rating) %}★{% endfor %}
                  {% for i in range(5 - review.rating) %}☆{% endfor %}
                </span>
              </div>
              <p class="mt-2">{{ review.review_text }}</p>
            </div>
          {% endfor %}
        {% else %}
          <p class="text-muted">No reviews yet. Be the first to leave one!</p>
        {% endif %}

        <div class="mt-4">
          {% if current_user.is_authenticated %}
            <a href="{{ url_for('auth.submit_review', product_id=product.id) }}"
               class="btn btn-outline-danger">
              Leave a Review
            </a>
          {% else %}
            <p class="text-muted">
              You must
              <a href="{{ url_for('auth.login') }}">log in</a>
              to leave a review.
            </p>
          {% endif %}
        </div>
      </div>
      <!-- End Reviews Section -->

    </div>
  </div>
</div>
{% endblock %}








admin page 

import os
from flask import Blueprint, abort, app, flash, redirect, render_template, request, send_from_directory, url_for
from flask_login import login_required, current_user
from .forms import ProductInventoryForm, UpdateOrderStatusForm
from werkzeug.utils import secure_filename
from .models import Customer, Order, Product, ProductImage
from . import db
from flask import current_app

admin = Blueprint('admin', __name__)

UPLOAD_FOLDER = 'static/uploads/'
ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif'}

os.makedirs(UPLOAD_FOLDER, exist_ok=True)

def allowed_file(filename):
    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS



@admin.route('/media/<path:filename>')
def get_image(filename):
    return send_from_directory('../media', filename)


def save_picture(form_picture):
    picture_filename = secure_filename(form_picture.filename)
    picture_path = os.path.join(app.config['UPLOAD_FOLDER'], picture_filename)
    form_picture.save(picture_path)
    return picture_filename



@admin.route('/add-shop-items', methods=['GET', 'POST'])
@login_required
def add_shop_items():
    if current_user.id != 1:
        return render_template('404.html')

    form = ProductInventoryForm()
    if form.validate_on_submit():
        # 1) Create the Product record (without images yet)
        new_item = Product(
            product_name    = form.product_name.data,
            price           = form.price.data,
            sale_price      = form.sale_price.data,
            description     = form.description.data,
            category        = form.category.data,
            quantity        = form.quantity.data,
            # you can keep a fallback main image if you want,
            # e.g. first file's filename:
            product_picture = None
        )
        db.session.add(new_item)
        db.session.flush()  # so new_item.id is assigned

        # 2) Save each uploaded image & record in ProductImage
        for upload in form.product_images.data:
            filename = secure_filename(upload.filename)
            upload.save(os.path.join(current_app.config['UPLOAD_FOLDER'], filename))

            # On the very first image, set as `product_picture` if you like:
            if new_item.product_picture is None:
                new_item.product_picture = filename

            img = ProductImage(
                product_id = new_item.id,
                image_url  = filename
            )
            db.session.add(img)

        # 3) Commit everything
        try:
            db.session.commit()
            flash(f"'{new_item.product_name}' added successfully!", "success")
            return redirect(url_for('admin.add_shop_items'))
        except Exception as e:
            db.session.rollback()
            flash(f"Error saving product: {e}", "danger")

    return render_template('add-shop-items.html', form=form)



@admin.route('/store-items', methods=['GET'])
@login_required
def shop_items():
    if current_user.id != 1:
        return render_template('404.html')

    items = Product.query.order_by(Product.created_at).all()
    return render_template('shop_items.html', items=items)


@admin.route('/update-item/<int:item_id>', methods=['GET', 'POST'])
@login_required
def update_item(item_id):
    if current_user.id != 1:
        return render_template('404.html')

    # 1) fetch the product
    item = Product.query.get_or_404(item_id)

    # 2) instantiate form, pre-populating from the product
    form = ProductInventoryForm(obj=item)
    # since we're updating, images should be optional:
    form.product_images.validators = []

    if form.validate_on_submit():
        # 3) update the simple fields
        form.populate_obj(item)

        # 4) handle any newly uploaded images
        file = request.files['product_picture']
        if file and allowed_file(file.filename):
            # Secure the filename and save it
            filename = secure_filename(file.filename)
            file_path = os.path.join(UPLOAD_FOLDER, filename)
            file.save(file_path)
            
            # Update the database with the filename (not the FileStorage object)
            item.product_picture = filename  # Save the file name or path (not FileStorage)
            db.session.commit()

        db.session.commit()
        flash(f"Product #{item.id} updated!", "success")
        return redirect(url_for('admin.shop_items'))

    return render_template('update_items.html',
                           form=form,
                           item=item)
    


@admin.route('/delete-item/<int:item_id>', methods=['GET'])
@login_required
def delete_item(item_id):
    if current_user.id != 1:
        return render_template('404.html')

    item = Product.query.get_or_404(item_id)

    try:
        # First delete all related images (if you have a related model)
        for img in item.images:
            # Optional: also delete the image file from disk if you want
            image_path = os.path.join(current_app.root_path, 'static/uploads', img.image_url)
            if os.path.exists(image_path):
                os.remove(image_path)
            db.session.delete(img)

        # Then delete the item itself
        db.session.delete(item)
        db.session.commit()
        flash('Item and associated images deleted successfully!', 'success')
    except Exception as e:
        db.session.rollback()
        flash(f'Failed to delete item. Error: {e}', 'danger')

    return redirect(url_for('admin.shop_items'))




@admin.route('/delete-product-image/<int:image_id>', methods=['POST'])
@login_required
def delete_product_image(image_id):
    if current_user.id != 1:
        return render_template('404.html')

    img = ProductImage.query.get_or_404(image_id)
    
    try:
        # Delete image file from disk
        image_path = os.path.join(current_app.root_path, 'static/uploads', img.image_url)
        if os.path.exists(image_path):
            os.remove(image_path)

        # Delete image record from database
        db.session.delete(img)
        db.session.commit()

        flash('Image deleted successfully!', 'success')
    except Exception as e:
        db.session.rollback()
        flash(f'Failed to delete image. Error: {e}', 'danger')

    return redirect(request.referrer or url_for('admin.shop_items'))